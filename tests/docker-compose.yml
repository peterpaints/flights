version: '3'
services:
  tests-unit: &tests-unit
    # build: .
    image: flights
    command: nosetests -e integration --verbosity 3 ./tests
    environment:
      - DIRECT_REDIS=1
      - FLASK_ENV=development
    volumes:
      - ./:/flights

  tests-integration: &tests-integration
    <<: *tests-unit
    command: >
      nosetests -e unit --verbosity 3 ./tests
    depends_on:
      postgres:
        condition: service_healthy
      - redis

  tests-all:
    <<: *tests-integration
    command: nosetests --verbosity 3 ./tests

  postgres:
    image: postgres
    ports:
      - "5432:5432"

  redis:
    image: redis:3.2.5-alpine
    ports:
      - "6379:6379"
